# Code for "The human intermediate prolactin receptor is a mammary proto-oncogene." by Grible J, et al

There are 2 workflows for the scripts in this repository.

 1) "hPRLrI_Isoform-Level_Expression" contains the scripts to download BAM files from the Genomic Data Commons for the TCGA-BRCA project and identify isoform-level expression of the hPRLr gene.
 2) "Global_DE_Analysis_with_hPRLrI_Patient_Groups" contains the isoform-level expression identified by step 1 and the scripts used to sub-set TCGA-BRCA patients by this expression and run a global differential gene expression analysis.
 
In both instances above, data from the Genomic Data Commons must be downloaded to run the scripts.  For step 1 you will need access to controlled data through a data use agreement with dbGap.  We provide the manifest files containing the file names needing to be downloaded.  For step 2, you will need to navigate to the GDC Data Portal and download all htseq-count.txt files for the 1222 BRCA patients and save them in the data directory of the "Global_DE_Analysis_with_hPRLrI_Patient_Groups" folder prior to running the script.

Both steps above can be run independantly.


## Workflow 1

### Purpose

This workflow downloads the aligned BAM files for all 1222 TCGA-BRCA patients in the Genomic Data Commons, extracts chromosome 5 (for reduce computational time), converts these reads to fastq files, and then re-aligns them to the transcriptome in order to obtain isoform-level expression for the hPRL Receptor.  This workflow will require you to have controlled data access for the GDC and significant computing/storage resources.

### Required Software

You will need the following installed on a linux-base server to run these scripts:

 - GDC Data Download tool
 - GDC-GRCh38 reference genome
 - SAMTools
 - BEDTools
 - STAR
 - Salmon
 - R

### Workflow 1 Steps

 1) Download GDC BAM files from TCGA-BRCA project using the "gdc_download_from_manifest" script and the "gdc_manifest_BRCA_RNASeq_1222samples_20191015.txt" manifest file.  Note: you will need to install the GDC Download tool on a linux-based server.
 
 2) Run the "01_extract_chr5.sh" bash script to extract chromosome 5 reads and convert them to FastQ files.  Requires a list of files to process saved as a text file, one file name per line.
 
 3) Edit the "02_STARalign.sh" on line 74 to point to your copy of the GDC GRCh38 human reference genome.
 
 4) Run the "02_STARalign.sh" script to align the newly generated fastq files to the human reference genome. This requires a list of fastq files to process, the first column should be for read 1 files and the second column should be the corresponding read 2 fastq files.
 
 5) Run the "03_Salmon.sh" bash script to count reads aligned to each isoform on chromosome 5.  Requires a list of BAM files, one per line.
 
 6) Edit line 14 of the "TPMCalc_DataPreproc.R" file to point to the directory where the Salmon output was saved on your system.
 
 7) Run the "TPMCalc_DataPreproc.R" script in R to generate the read count and TPM files for the hPRLr and hPRLrI isoforms.  This script uses the "calc.tpm.fromSalmon.R" script, so make sure it is in the same directory.


## Workflow 2

### Purpose

This workflow uses the hPRLr and hPRLrI isoform expression identified from Workflow 1 to subset TCGA-BRCA patients based on the expression pattern of this isoform.  It then runs a classic Differential Expression analysis using DESeq2 between these patient groups using the gene-level HTSeq-count data generated by the GDC.

### Required Software

You will need the following installed on your computer to run this workflow:

 - R
 - R DESeq2 and dplyr libraries

### Workflow 2 Steps

 1) Nagivate to the Genomic Data Commons Data Portal and download all 1222 HTSeq-count RNASeq files for the TCGA-BRCA project into the Global_DE_Analysis_with_hPRLrI_Patient_Groups/data directory of this repository.
 2) Run the "DESeq2_Analysis_BRCA_022620.R" script in R.
